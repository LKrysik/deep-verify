# Meta-Schema: Step Contract (Frontmatter)
# Validates: The YAML block at the top of phases/{phase}/{step}.md

type: object
required:
  - id
  - type
  - name
  - next

properties:
  id:
    type: string
    description: "Unique step ID (e.g., create-story)"

  type:
    type: string
    enum: [step, gate, trigger]
    default: step
    description: "Behavior type of this contract"

  name:
    type: string
    description: "Human-readable label for the UI"

  inputs:
    type: array
    items: { type: string }
    description: "List of file paths or patterns to inject into context BEFORE execution"

  outputs:
    type: array
    items: { type: string }
    description: "List of file paths or patterns expected to be created/modified"

  output_contract:
    type: string
    description: "Name of the schema validating the primary output (e.g., 'story', 'risk')"

  tools:
    type: array
    items:
      type: object
      properties:
        name: { type: string }
        command: { type: string }
    description: "Deterministic tools available for this step"

  next:
    type: object
    required: [success]
    properties:
      success: { type: string, description: "ID of next step on success" }
      failure: { type: string, description: "ID of next step on failure (retry/loop)" }
