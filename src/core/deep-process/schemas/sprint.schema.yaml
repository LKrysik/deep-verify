# Schema: Sprint
# Used for: artifacts/sprints/SPRINT-XXX.yaml

type: object
required:
  - id
  - name
  - goal
  - start_date
  - end_date
  - capacity
  - status
  - created_at

properties:
  id:
    type: string
    pattern: "^SPRINT-\\d{3}$"
    description: "Unique sprint identifier"
    example: "SPRINT-001"

  name:
    type: string
    minLength: 5
    maxLength: 50
    description: "Sprint name"
    example: "Sprint 1 - Foundation"

  goal:
    type: string
    minLength: 10
    description: "Sprint goal - what we aim to achieve"
    example: "Basic authentication working end-to-end"

  start_date:
    type: string
    format: date
    description: "Sprint start date"
    example: "2026-02-03"

  end_date:
    type: string
    format: date
    description: "Sprint end date"
    example: "2026-02-14"

  capacity:
    type: integer
    minimum: 1
    description: "Team capacity in story points"
    example: 20

  committed_points:
    type: integer
    minimum: 0
    description: "Total points committed to sprint"
    example: 18

  completed_points:
    type: integer
    minimum: 0
    default: 0
    description: "Points completed so far"

  stories:
    type: array
    items:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          pattern: "^STORY-\\d{3}$"
        points:
          type: integer
        status:
          type: string
    description: "Stories in this sprint"
    example:
      - id: STORY-001
        points: 3
        status: done
      - id: STORY-002
        points: 5
        status: in_progress

  status:
    type: string
    enum:
      - planned
      - active
      - completed
      - cancelled
    description: "Sprint status"

  velocity:
    type: integer
    description: "Actual velocity (set after completion)"

  burndown:
    type: array
    items:
      type: object
      properties:
        date:
          type: string
          format: date
        remaining_points:
          type: integer
    description: "Daily burndown data"

  retrospective:
    type: object
    properties:
      what_went_well:
        type: array
        items:
          type: string
      what_to_improve:
        type: array
        items:
          type: string
      action_items:
        type: array
        items:
          type: string
    description: "Sprint retrospective notes"

  created_at:
    type: string
    format: date-time

  started_at:
    type: string
    format: date-time
    description: "Actual sprint start"

  completed_at:
    type: string
    format: date-time
    description: "Actual sprint completion"

  # Integration
  azure_devops_iteration:
    type: string
    description: "Azure DevOps Iteration path"

# Validation rules
validation:
  - rule: "end_date > start_date"
    check: "end_date must be after start_date"

  - rule: "committed_points <= capacity"
    check: "cannot commit more than capacity"

  - rule: "no blocked stories"
    check: "all stories in sprint must not have status: blocked"

  - rule: "active requires started_at"
    check: "if status is active then started_at must be set"

# Example document
example:
  id: SPRINT-001
  name: "Sprint 1 - Foundation"
  goal: "Basic authentication working end-to-end"
  start_date: "2026-02-03"
  end_date: "2026-02-14"
  capacity: 20
  committed_points: 18
  completed_points: 8
  stories:
    - id: STORY-001
      points: 3
      status: done
    - id: STORY-002
      points: 5
      status: done
    - id: STORY-003
      points: 5
      status: in_progress
    - id: STORY-004
      points: 5
      status: ready
  status: active
  created_at: "2026-02-01T11:00:00Z"
  started_at: "2026-02-03T09:00:00Z"
